## Описание

Пайплайн для предобработки и базового анализа экспериментов одноклеточного RNAseq. 
Является сборкой лучших пакетов и программ для анализа scRNAseq.
Текущая версия пайплайна состоит из трёх основных частей, которые могут быть использованы как вместе
так и по отдельности. 

1) Препроцессинг сырых ридов. 
На вход: GEO id эксперимента, конфигурационный файл с описанием схемы баркодирования и числа клеток
Выход: рид-каунт матрицы, в которых при наличии UMI уже произведено удаление ПЦР-дубликатов
2) Предбработка рид-каунтов:
На вход: ридкаут-матрица 
Выход: нормализованные, почищенные от выбросов, лог-нормированные ридкаунты (условно буду называть «экспрессия»)
3) Кластеризация клеток и поиск маркеров
На вход: матрица экспрессии
Выход: Seurat-объект в котором содержится информация о финальных, неделимых более кластерах и 
таблица с перечислением найденных для каждого кластера маркеров с учётом информации о маркерах промежуточных кластеров. 
Таблица содержит стандартные скоры adj_pval, fold_change а так же информацию о проценте клеток кластера 
для которых этот ген является маркером. 

## Ограничения
__В полностью автоматическом режиме от SRR (1.) до маркеров пайплайн ограничен следующими протоколами:
inDrop v1 & v2, inDrop v3 и совместимыми с ними на уровне схемы баркодирования (Cell-Seq, Cell-Seq2,...)__

__При анализе от рид-каут матриц (2.) не поддерживается протокол 10X и Nanostring.__

Оптимальные входные данные: матрица сырых, ненормированных ридкаунтов с числом клеток от 30 до 5000 и числом генов от 1000 до 12000.
Строки - гены, столбцы - клетки

Поддерживаемые имена генов: 
Ensembl, Symbol(MGI, HGNC)
```
ENSG00000111704, ENSG00000181449
ENSMUSG00000012396, ENSMUSG00000074637
Nanog, Sox2
```
Поддерживаемый формат имён клеток: <тип_клетки>.<номер_клетки> 
```
 "d7.122" "d0.484" "d2.39"  "d2.213"
 "mef.1" "mef.2" "early2cell.1" "zy.1"
```
При подаче заранее нормализованных данных (TPM, RPKM, FPKM) к ним автоматически будет применена функция rel2abs из пакета monocle2.


## Препроцессинг ридов

В текущем состоянии поддерживаются протоколы:
    inDrop v1 & v2, inDrop v3, 10x, iCLIP и имеющие идентичную названным структуру баркодов. 
    По умолчанию поддерживаются мышиный и человеческий геномы. 
    При первом запуске будут автоматически подгружены mm10 и hg19 соответственно в зависимости от 
    выбранного в настройках организма. Так же будет загружена gencode-аннотация к ним.

### Тулчейн:
1) SRA tools prefetch – загрузка ридов по SRR id или id эксперимента, стандартно
2) fastq-dump – разбиение парных ридов, стандартно
3) droptag – демультиплексирование баркодов, тримминг низкокачественных ридов
4) STAR – выравнивание, стандартно. Так как droptag генерирует несколько SRR из исходного, запускаем выравнивание для каждого
5) dropest – подсчёт рид-каунтов, удаление ПЦР-дубликатов используя выравнивания
6) Если при запуске препроцессинга установлен флаг clean, все промежуточные файлы удаляются (SRA, SRR, BAM), оставляя только финальный файл с матрицей рид-каунтов

Полученная матица находится в папке 
```
$reads_path/$srr_id/cell.counts.matrices.rds
```

По умолчанию 

reads_path=/home/SingleCellRNASeq/reads, srr_id берётся из имени входного SRR
 ```
  /home/SingleCellRNASeq/reads/SRR1784310/cell.counts.matrices.rds
  /home/SingleCellRNASeq/reads/SRR1784311/cell.counts.matrices.rds
```

## Преобработка рид-каунтов


